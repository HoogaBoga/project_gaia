# Project Gaia â€” Flutter Companion App ðŸŒ¿ðŸ“±

**Give your plant a voice, a face, and a personality.**

Project Gaia is a Flutter-based IoT companion app that connects to an ESP32 sensor device to monitor a real plant's environment in real time. It creates a **digital twin** â€” an AI-generated pixel-art avatar that visually reflects your plant's health â€” and lets you **chat with your plant** through a personality-driven AI chatbot powered by Google Gemini.

> **Hardware counterpart:** This app works with the [Project Gaia Device](https://github.com/mjtagaan/project_gaia_device) â€” an ESP32 firmware that reads environmental sensors and syncs data through Firebase.

---

## Features

- **Real-Time Sensor Monitoring** â€” Live readings for soil moisture, humidity, temperature, and light intensity streamed from the ESP32 via Firebase Realtime Database.
- **AI Digital Twin** â€” Three pixel-art plant avatars (healthy, warning, critical) generated by Gemini AI with transparent backgrounds via remove.bg.
- **Chat with Your Plant** â€” A conversational AI chatbot where your plant responds in-character based on its chosen personality (Friendly, Calm, Energetic, Wise, or Playful).
- **Health Dashboard** â€” Concentric ring visualizations showing each environmental metric, overall health percentage, and an AI-generated health analysis.
- **Smart Notifications** â€” Alerts when conditions go outside optimal ranges (too hot, too cold, too dry, thirsty, etc.), powered by species-specific care profiles from Gemini.
- **Camera-Based Plant Identification** â€” Snap a photo during onboarding and Gemini identifies the species automatically.
- **Plant Profile Management** â€” Name your plant, choose its personality, edit or delete it at any time.

---

## Tech Stack

| Layer | Technology |
| --- | --- |
| **Framework** | Flutter (Dart) |
| **Architecture** | MVVM via [Stacked](https://pub.dev/packages/stacked) |
| **Backend** | Firebase Realtime Database + Firebase Storage |
| **AI** | Google Gemini API (text generation + image generation) |
| **Image Processing** | [remove.bg](https://www.remove.bg/) API for background removal |
| **IoT Hardware** | ESP32 with DHT22, BH1750, capacitive soil moisture sensor ([device repo](https://github.com/mjtagaan/project_gaia_device)) |

---

## Project Structure

```
lib/
â”œâ”€â”€ main.dart                  # App entry point, Firebase init
â”œâ”€â”€ env.dart                   # API keys (gitignored)
â”œâ”€â”€ firebase_options.dart      # Firebase config (auto-generated)
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ app.dart               # Stacked app config (routes, DI, dialogs)
â”‚   â”œâ”€â”€ app.locator.dart       # Service locator (get_it)
â”‚   â”œâ”€â”€ app.router.dart        # Generated route definitions
â”‚   â”œâ”€â”€ app.dialogs.dart       # Dialog registration
â”‚   â””â”€â”€ app.bottomsheets.dart  # Bottom sheet registration
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ firebase_service.dart  # Firebase RTDB & Storage operations
â”‚   â”œâ”€â”€ gemini_service.dart    # Gemini AI (chat, image gen, species ID, analysis)
â”‚   â””â”€â”€ remove_bg_service.dart # remove.bg background removal
â””â”€â”€ ui/
    â”œâ”€â”€ views/
    â”‚   â”œâ”€â”€ splash/            # Onboarding (species, name, personality)
    â”‚   â”œâ”€â”€ generating/        # AI image generation loading screen
    â”‚   â”œâ”€â”€ mainlayout/        # Shell with IndexedStack + bottom nav
    â”‚   â”œâ”€â”€ home/              # Dashboard with digital twin + HP bar
    â”‚   â”œâ”€â”€ stats/             # Health rings + AI analysis
    â”‚   â”œâ”€â”€ chat/              # "Ask Gaia" chatbot
    â”‚   â”œâ”€â”€ settings/          # Plant profile + delete
    â”‚   â”œâ”€â”€ edit_plant/        # Edit name/personality
    â”‚   â””â”€â”€ startup/           # Initial route resolver
    â”œâ”€â”€ widgets/               # Reusable components (navbar, notifications)
    â”œâ”€â”€ common/                # Shared UI utilities
    â”œâ”€â”€ dialogs/               # Delete confirmation, info alerts
    â””â”€â”€ bottom_sheets/         # Notice sheet
```

---

## Getting Started

### Prerequisites

- [Flutter SDK](https://docs.flutter.dev/get-started/install) (>=3.0.3 <4.0.0)
- A Firebase project with **Realtime Database** and **Storage** enabled
- A [Google Gemini API key](https://aistudio.google.com/apikey)
- A [remove.bg API key](https://www.remove.bg/api)
- The [Project Gaia Device](https://github.com/mjtagaan/project_gaia_device) (ESP32 hardware) connected to the same Firebase project

### 1. Clone the Repository

```bash
git clone https://github.com/mjtagaan/project_gaia.git
cd project_gaia
```

### 2. Configure API Keys

Create the file `lib/env.dart` (it is gitignored):

```dart
class Env {
  static const String googleGeminiApiKey = String.fromEnvironment(
    'GEMINI_API_KEY',
    defaultValue: 'YOUR_GEMINI_API_KEY_HERE',
  );

  static const String removeBgApiKey = String.fromEnvironment(
    'REMOVE_BG_API_KEY',
    defaultValue: 'YOUR_REMOVE_BG_API_KEY_HERE',
  );
}
```

Alternatively, pass keys at build time:

```bash
flutter run --dart-define=GEMINI_API_KEY=your_key --dart-define=REMOVE_BG_API_KEY=your_key
```

### 3. Configure Firebase

1. Create a Firebase project at [console.firebase.google.com](https://console.firebase.google.com/).
2. Enable **Realtime Database** (Asia Southeast 1 region recommended) and **Storage**.
3. Install the [FlutterFire CLI](https://firebase.flutter.dev/docs/cli/) and run:
   ```bash
   flutterfire configure
   ```
4. Place `google-services.json` in `android/app/`.
5. Ensure your database has the `plants/gaia_01` path structure as described in the [device repo](https://github.com/mjtagaan/project_gaia_device#-data-structure).

### 4. Install Dependencies

```bash
flutter pub get
```

### 5. Run Code Generation

The project uses Stacked's code generator for routes, dependency injection, and dialog/bottom sheet registration:

```bash
dart run build_runner build --delete-conflicting-outputs
```

### 6. Run the App

```bash
flutter run
```

---

## Firebase Data Structure

The app reads sensor data from and writes plant profiles to `plants/gaia_01`:

```json
{
  "plants": {
    "gaia_01": {
      "temperature": 25.5,
      "humidity": 60.0,
      "soil_moisture": 45,
      "soil_raw": 2400,
      "light_intensity": 500,
      "timestamp": 1700000000,
      "profile": {
        "name": "Fern",
        "species": "Boston Fern",
        "personality": "Friendly"
      },
      "visuals": {
        "perfect": { "imageUrl": "...", "timestamp": "..." },
        "warning": { "imageUrl": "...", "timestamp": "..." },
        "critical": { "imageUrl": "...", "timestamp": "..." }
      },
      "thresholds": {
        "species": "Boston Fern",
        "moisture_low": 40,
        "moisture_high": 80,
        "temp_low": 15.0,
        "temp_high": 28.0,
        "humidity_low": 50.0,
        "humidity_high": 80.0,
        "lux_low": 200.0,
        "lux_high": 800.0
      }
    }
  }
}
```

---

## How It Works

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         Firebase RTDB         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ESP32 Device â”‚ â”€â”€â”€â”€ sensor data upload â”€â”€â”€â”€â”€â–¶ â”‚                  â”‚
â”‚  (Gaia Device)â”‚ â—€â”€â”€ threshold download â”€â”€â”€â”€â”€â”€â”€ â”‚  Firebase Cloud  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚                  â”‚
                                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                          â”‚
                                                   stream â”‚ read/write
                                                          â”‚
                                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                 â”‚  Flutter App     â”‚
                                                 â”‚  (Project Gaia)  â”‚
                                                 â”‚                  â”‚
                                                 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                                                 â”‚  â”‚ Gemini AI   â”‚ â”‚
                                                 â”‚  â”‚ - Chat      â”‚ â”‚
                                                 â”‚  â”‚ - Image Gen â”‚ â”‚
                                                 â”‚  â”‚ - Plant ID  â”‚ â”‚
                                                 â”‚  â”‚ - Analysis  â”‚ â”‚
                                                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                                 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                                                 â”‚  â”‚ remove.bg   â”‚ â”‚
                                                 â”‚  â”‚ - BG removalâ”‚ â”‚
                                                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

1. The **ESP32 device** reads environmental sensors and uploads data to Firebase every few seconds.
2. The **Flutter app** streams this data in real time and normalizes readings to health percentages.
3. During onboarding, **Gemini AI** identifies the plant species from a photo and generates three pixel-art avatars.
4. **remove.bg** strips backgrounds from the generated images for clean compositing.
5. The app displays the appropriate avatar based on current health, and the **chatbot** responds in the plant's personality.
6. **Species-specific thresholds** are written to Firebase so the ESP32 device can adapt its OLED face reactions.

---

## Golden Tests

Golden tests are set up for this project. To run and update the golden files:

```bash
flutter test --update-goldens
```

Golden test screenshots are stored under `test/golden/`.
